# 実装タスクリスト

このドキュメントは、「しのうたタイム」アプリケーションの実装タスクを定義します。各タスクは要件定義書と設計書に基づいて作成されています。

**注意**: このプロジェクトは既に実装済みのため、以下のタスクは主にドキュメント整備、リファクタリング、テスト追加、機能改善を目的としています。

## タスク一覧

- [ ] 1. プロジェクト構造の整理とドキュメント整備
  - プロジェクトのディレクトリ構造を確認し、必要に応じて整理する
  - README.mdを更新し、プロジェクトの目的、機能、セットアップ手順を明確に記述する
  - requirements.txtに全ての依存関係が記載されているか確認する
  - _要件: 全要件_

- [ ] 2. データモデルとユーティリティ関数の整理
- [ ] 2.1 タイムスタンプ変換関数の分離
  - `convert_timestamp_to_seconds`関数を独立したユーティリティモジュール（例: `utils/time_utils.py`）に移動する
  - 関数のdocstringを追加し、引数と戻り値を明確に記述する
  - _要件: 1.1, 6.1_

- [ ] 2.2 データ読み込み関数の共通化
  - TSVファイル読み込み処理を共通関数として抽出する（例: `utils/data_loader.py`）
  - エラーハンドリングを統一する
  - キャッシュ機能を適切に適用する
  - _要件: 1.1, 1.2, 1.3, 1.4, 8.1_

- [ ] 2.3 URL生成関数の分離
  - YouTubeタイムスタンプ付きURL生成処理を独立した関数として抽出する
  - HTMLリンクタグ生成処理も関数化する
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 2.4 ユーティリティ関数の単体テスト作成
  - `convert_timestamp_to_seconds`のテストケースを作成する（正常系、異常系、境界値）
  - URL生成関数のテストケースを作成する
  - データ読み込み関数のテストケースを作成する
  - _要件: 1.1, 6.1, 8.1_

- [ ] 3. データ処理ロジックの改善
- [ ] 3.1 データ結合処理の最適化
  - Home.pyのデータ結合処理を関数として抽出する
  - 結合後のカラム名変更処理を整理する
  - 不要な列の削除処理を早期化する
  - _要件: 1.5_

- [ ] 3.2 曲目番号生成ロジックの関数化
  - 曲目番号生成処理を独立した関数として抽出する
  - ライブ番号の計算ロジックを明確化する
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 3.3 ソート処理の統一
  - ソート処理を共通関数として抽出する
  - ソートキーの定義を明確化する
  - _要件: 4.3, 4.4, 4.5, 8.2, 8.3_

- [ ]* 3.4 データ処理ロジックの統合テスト作成
  - データ読み込みから表示までの一連の流れをテストする
  - 検索フィルタリングの統合テストを作成する
  - _要件: 1.5, 2.3, 4.3, 4.4, 4.5_

- [ ] 4. 検索機能の改善
- [ ] 4.1 検索処理の関数化
  - 検索フィルタリング処理を独立した関数として抽出する
  - 検索条件の構築ロジックを明確化する
  - _要件: 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 3.2, 3.3_

- [ ] 4.2 検索UIの改善
  - 検索ボックスとチェックボックスの配置を最適化する
  - 検索結果のフィードバックを改善する
  - _要件: 2.1, 2.2, 2.7, 3.1_

- [ ]* 4.3 検索機能の単体テスト作成
  - 曲名検索のテストケースを作成する
  - アーティスト名検索のテストケースを作成する
  - ライブタイトル検索のテストケースを作成する
  - 大文字小文字を区別しない検索のテストを作成する
  - _要件: 2.3, 2.4, 2.5, 2.6, 3.2_

- [ ] 5. 段階的表示機能の改善
- [ ] 5.1 表示制御ロジックの関数化
  - 段階的表示の制御ロジックを独立した関数として抽出する
  - セッション状態の管理を明確化する
  - _要件: 4.6, 5.1, 5.2, 5.3, 5.4_

- [ ] 5.2 表示件数の設定可能化
  - 初期表示件数と追加表示件数を設定ファイルまたは定数として定義する
  - 将来的にユーザーが設定できるようにする準備をする
  - _要件: 4.6, 5.1, 5.2_

- [ ]* 5.3 段階的表示機能のテスト作成
  - 初期表示のテストケースを作成する
  - 追加表示のテストケースを作成する
  - 全件表示完了時のテストケースを作成する
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 6. 情報ページ機能の改善
- [ ] 6.1 Twitter埋め込み表示関数の改善
  - `display_embedded_tweet`関数のエラーハンドリングを強化する
  - 高さ設定の検証処理を追加する
  - _要件: 9.3, 9.4, 9.5_

- [ ] 6.2 過去のお知らせ管理の改善
  - 過去のお知らせをデータファイルとして外部化する
  - お知らせの追加・編集を容易にする
  - _要件: 9.6_

- [ ]* 6.3 情報ページ機能のテスト作成
  - YouTube動画埋め込みのテストケースを作成する
  - Twitter埋め込みのテストケースを作成する
  - ファイル不在時のエラーハンドリングのテストを作成する
  - _要件: 9.1, 9.2, 9.3, 9.4, 9.5_

- [ ] 7. 楽曲リストページの改善
- [ ] 7.1 ソート処理の改善
  - 漢字のソート順を改善する（日本語ロケールの適用）
  - ソート用カラムの生成ロジックを明確化する
  - _要件: 8.2, 8.3_

- [ ] 7.2 重複楽曲の検出と処理
  - 重複楽曲を検出する処理を追加する
  - 重複楽曲の統合または警告表示を実装する
  - _要件: 8.1, 8.4_

- [ ]* 7.3 楽曲リストページのテスト作成
  - データ読み込みのテストケースを作成する
  - ソート処理のテストケースを作成する
  - 重複検出のテストケースを作成する
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 8. スタイリングの改善
- [ ] 8.1 CSSファイルの整理
  - style.cssのコメントを充実させる
  - 未使用のスタイル定義を削除する
  - スタイルの命名規則を統一する
  - _要件: 11.1, 11.5, 11.6, 11.7_

- [ ] 8.2 レスポンシブデザインの強化
  - モバイル表示の最適化を行う
  - タブレット表示の最適化を行う
  - メディアクエリを追加する
  - _要件: 11.7_

- [ ] 8.3 インラインCSSの外部化
  - 99_Song_List_beta.pyのインラインCSSをstyle.cssに移動する
  - CSSの重複を削除する
  - _要件: 11.1_

- [ ]* 8.4 スタイリングのビジュアルテスト
  - 各ページのスクリーンショットを取得する
  - デスクトップ、タブレット、モバイルでの表示を確認する
  - _要件: 11.1, 11.2, 11.3, 11.4, 11.7_

- [ ] 9. エラーハンドリングの強化
- [ ] 9.1 エラーメッセージの統一
  - エラーメッセージのフォーマットを統一する
  - エラーレベル（error/warning/info）の使い分けを明確化する
  - _要件: 13.1, 13.2, 13.3, 13.5_

- [ ] 9.2 ログ機能の追加
  - エラーログをファイルに出力する機能を追加する
  - デバッグ用のログレベルを設定可能にする
  - _要件: 13.1, 13.2, 13.3_

- [ ]* 9.3 エラーハンドリングのテスト作成
  - ファイル不在時のエラーハンドリングをテストする
  - データ変換エラーのハンドリングをテストする
  - 各種例外処理のテストケースを作成する
  - _要件: 13.1, 13.2, 13.3, 13.4, 13.5_

- [ ] 10. 設定管理の実装
- [ ] 10.1 設定ファイルの作成
  - アプリケーション設定を外部ファイル（config.yaml または config.json）として定義する
  - 表示件数、ファイルパス、デフォルト値などを設定可能にする
  - _要件: 全要件_

- [ ] 10.2 設定読み込み機能の実装
  - 設定ファイルを読み込む共通モジュールを作成する
  - 設定値の検証処理を追加する
  - デフォルト値のフォールバック処理を実装する
  - _要件: 全要件_

- [ ]* 10.3 設定管理のテスト作成
  - 設定ファイル読み込みのテストケースを作成する
  - 設定値検証のテストケースを作成する
  - デフォルト値フォールバックのテストケースを作成する
  - _要件: 全要件_

- [ ] 11. パフォーマンス最適化
- [ ] 11.1 データキャッシュの最適化
  - キャッシュの有効期限を設定する
  - キャッシュのクリア機能を追加する
  - _要件: 1.1, 8.1_

- [ ] 11.2 データ処理の最適化
  - 不要なデータコピーを削減する
  - Pandasの最適化されたメソッドを使用する
  - _要件: 1.5, 4.3, 4.4, 4.5_

- [ ]* 11.3 パフォーマンステスト作成
  - データ読み込み速度のベンチマークを作成する
  - 検索速度のベンチマークを作成する
  - 表示速度のベンチマークを作成する
  - _要件: 1.1, 2.3, 4.6_

- [ ] 12. ドキュメントの充実
- [ ] 12.1 コードコメントの追加
  - 各関数にdocstringを追加する
  - 複雑なロジックにインラインコメントを追加する
  - _要件: 全要件_

- [ ] 12.2 開発者向けドキュメントの作成
  - アーキテクチャ図を作成する（Mermaid形式）
  - データフロー図を作成する
  - コーディング規約を文書化する
  - _要件: 全要件_

- [ ] 12.3 ユーザー向けドキュメントの作成
  - 使い方ガイドを作成する
  - FAQ（よくある質問）を作成する
  - トラブルシューティングガイドを作成する
  - _要件: 全要件_

- [ ]* 12.4 ドキュメントの品質確認
  - ドキュメントの内容が最新のコードと一致しているか確認する
  - リンク切れがないか確認する
  - 誤字脱字がないか確認する
  - _要件: 全要件_

- [ ] 13. セキュリティ強化
- [ ] 13.1 入力検証の追加
  - 検索クエリの長さ制限を追加する
  - 特殊文字のエスケープ処理を確認する
  - _要件: 2.3_

- [ ] 13.2 外部リンクの検証
  - YouTube URLのドメイン検証を追加する
  - 不正なURLの検出と除外を実装する
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 13.3 セキュリティテスト作成
  - XSS攻撃のテストケースを作成する
  - 不正な入力値のテストケースを作成する
  - _要件: 2.3, 6.1_

- [ ] 14. CI/CDパイプラインの構築
- [ ] 14.1 GitHub Actionsの設定
  - テスト自動実行のワークフローを作成する
  - コードフォーマットチェックのワークフローを作成する
  - リントチェックのワークフローを作成する
  - _要件: 全要件_

- [ ] 14.2 デプロイメント自動化
  - Streamlit Cloudへの自動デプロイ設定を作成する
  - デプロイ前のテスト実行を設定する
  - _要件: 全要件_

- [ ]* 14.3 CI/CDパイプラインのテスト
  - ワークフローが正常に動作するか確認する
  - 失敗時の通知が正しく送信されるか確認する
  - _要件: 全要件_

- [ ] 15. 将来の機能拡張の準備
- [ ] 15.1 データベース移行の準備
  - データベーススキーマを設計する
  - TSVからデータベースへの移行スクリプトを作成する
  - _要件: 1.1, 1.2, 1.5_

- [ ] 15.2 API設計
  - RESTful APIのエンドポイント設計を行う
  - APIドキュメントを作成する
  - _要件: 全要件_

- [ ]* 15.3 拡張機能のプロトタイプ作成
  - お気に入り機能のプロトタイプを作成する
  - プレイリスト機能のプロトタイプを作成する
  - _要件: 全要件_

## タスク実行の優先順位

### 高優先度（すぐに実施すべき）
1. プロジェクト構造の整理とドキュメント整備（タスク1）
2. データモデルとユーティリティ関数の整理（タスク2）
3. エラーハンドリングの強化（タスク9）
4. 設定管理の実装（タスク10）

### 中優先度（次に実施すべき）
5. データ処理ロジックの改善（タスク3）
6. 検索機能の改善（タスク4）
7. 段階的表示機能の改善（タスク5）
8. スタイリングの改善（タスク8）
9. ドキュメントの充実（タスク12）

### 低優先度（余裕があれば実施）
10. 情報ページ機能の改善（タスク6）
11. 楽曲リストページの改善（タスク7）
12. パフォーマンス最適化（タスク11）
13. セキュリティ強化（タスク13）
14. CI/CDパイプラインの構築（タスク14）
15. 将来の機能拡張の準備（タスク15）

## 注意事項

- 各タスクは独立して実行可能ですが、依存関係がある場合は順序を守ってください
- テストタスク（*マーク付き）はオプションですが、品質向上のために推奨されます
- 既存のコードを変更する際は、必ず動作確認を行ってください
- リファクタリング時は、機能の動作が変わらないことを確認してください
