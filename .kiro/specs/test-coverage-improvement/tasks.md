# 実装タスクリスト

## フェーズ1: 基礎テストの追加（カバレッジ目標: 50%）

- [ ] 1. テストフィクスチャとヘルパーの作成
  - テスト用のサンプルHTMLデータを定義
  - テスト用のサンプルTSVデータを定義
  - モックレスポンスのヘルパー関数を作成
  - _要件: 全般_

- [ ] 2. Twitter API Clientのユニットテスト実装
- [ ] 2.1 基本的なAPI呼び出しテストを実装
  - 有効なURLでの成功ケース
  - レスポンスのパース
  - OEmbedResponseオブジェクトの生成
  - _要件: 1.1_

- [ ] 2.2 エラーハンドリングテストを実装
  - 404エラー（ツイート不存在）
  - 429エラー（レート制限）
  - ネットワークエラー
  - タイムアウトエラー
  - _要件: 1.2, 1.4, 1.5_

- [ ] 2.3 レート制限情報の更新テストを実装
  - レスポンスヘッダーからの情報抽出
  - RateLimitInfoオブジェクトの生成
  - _要件: 1.3_

- [ ] 2.4 プロパティテストを実装
  - **プロパティ1: 有効なURL処理の一貫性**
  - **検証: 要件1.1**

- [ ] 2.5 プロパティテストを実装
  - **プロパティ2: 無効なURL拒否の一貫性**
  - **検証: 要件1.2**

- [ ] 2.6 プロパティテストを実装
  - **プロパティ3: ネットワークエラーの適切な処理**
  - **検証: 要件1.4**

- [ ] 3. File Repositoryのユニットテスト実装
- [ ] 3.1 ファイル読み込みテストを実装
  - 正常な読み込み
  - 存在しないファイルの処理
  - 読み込みエラーの処理
  - _要件: 2.1, 2.3_

- [ ] 3.2 ファイル書き込みテストを実装
  - 正常な書き込み
  - ディレクトリの自動作成
  - 権限エラーの処理
  - _要件: 2.2_

- [ ] 3.3 バックアップ機能テストを実装
  - バックアップファイルの作成
  - タイムスタンプ付きファイル名
  - バックアップ失敗時の処理
  - _要件: 2.4_


- [ ] 3.4 プロパティテストを実装
  - **プロパティ4: ファイル読み書きのラウンドトリップ**
  - **検証: 要件2.1, 2.2**

- [ ] 3.5 プロパティテストを実装
  - **プロパティ5: バックアップの一貫性**
  - **検証: 要件2.4**

- [ ] 4. HTML Validatorのユニットテスト実装
- [ ] 4.1 HTML構造検証テストを実装
  - 有効なHTML構造の検証
  - blockquoteタグの検証
  - twitter-tweetクラスの検証
  - _要件: 3.1_

- [ ] 4.2 無効なHTML検証テストを実装
  - blockquoteタグ欠落
  - twitter-tweetクラス欠落
  - タグの不一致
  - 空のHTML
  - _要件: 3.2, 3.3_

- [ ] 4.3 エラーメッセージ検証テストを実装
  - エラーメッセージの内容確認
  - 警告メッセージの確認
  - _要件: 3.2_

- [ ] 4.4 プロパティテストを実装
  - **プロパティ6: 有効なHTML検証の一貫性**
  - **検証: 要件3.1**

- [ ] 4.5 プロパティテストを実装
  - **プロパティ7: 無効なHTML検証の一貫性**
  - **検証: 要件3.2**

- [ ] 5. Retry Utilityのユニットテスト実装
- [ ] 5.1 基本的なリトライ機能テストを実装
  - リトライ回数の検証
  - リトライ後の成功
  - すべてのリトライ失敗
  - _要件: 6.1, 6.2, 6.3_

- [ ] 5.2 指数バックオフテストを実装
  - 待機時間の計算
  - 最大遅延時間の制限
  - _要件: 6.4_

- [ ] 5.3 例外フィルタリングテストを実装
  - 特定の例外のみリトライ
  - その他の例外は即座に再送出
  - _要件: 6.5_

- [ ] 5.4 プロパティテストを実装
  - **プロパティ13: リトライ回数の一貫性**
  - **検証: 要件6.1**

- [ ] 5.5 プロパティテストを実装
  - **プロパティ14: 指数バックオフの一貫性**
  - **検証: 要件6.4**

- [ ] 5.6 プロパティテストを実装
  - **プロパティ15: 例外フィルタリングの一貫性**
  - **検証: 要件6.5**

- [ ] 6. チェックポイント - フェーズ1のテスト実行
  - すべてのテストが成功することを確認
  - カバレッジが50%以上であることを確認
  - ユーザーに質問がある場合は確認

## フェーズ2: サービス層のテスト追加（カバレッジ目標: 65%）

- [ ] 7. Twitter Embed Serviceのユニットテスト実装
- [ ] 7.1 埋め込みコード取得テストを実装
  - 成功ケース
  - URL検証
  - ツイートID抽出
  - _要件: 4.1_

- [ ] 7.2 埋め込みコード保存テストを実装
  - 保存成功
  - バックアップ作成
  - 保存失敗時の処理
  - _要件: 4.2, 4.5_

- [ ] 7.3 複数ツイート処理テストを実装
  - 複数URLの処理
  - 成功・失敗の集計
  - 最大高さの選択
  - _要件: 4.1_

- [ ] 7.4 エラー処理テストを実装
  - 無効なURL
  - API呼び出し失敗
  - ファイル書き込み失敗
  - _要件: 4.4_

- [ ] 7.5 プロパティテストを実装
  - **プロパティ8: 埋め込みコード取得の一貫性**
  - **検証: 要件4.1**

- [ ] 7.6 プロパティテストを実装
  - **プロパティ9: 埋め込みコード保存のラウンドトリップ**
  - **検証: 要件4.2, 4.3**

- [ ] 7.7 プロパティテストを実装
  - **プロパティ10: エラー処理の一貫性**
  - **検証: 要件4.4**

- [ ] 8. Data Serviceのユニットテスト実装
- [ ] 8.1 データ読み込みテストを実装
  - 配信データの読み込み
  - 楽曲データの読み込み
  - 楽曲リストデータの読み込み
  - ファイル不存在時の処理
  - _要件: 8.1, 8.3_

- [ ] 8.2 データ結合テストを実装
  - 正常な結合
  - 列名の変更
  - 不要な列の削除
  - _要件: 8.2_

- [ ] 8.3 エラーメッセージ管理テストを実装
  - エラーメッセージの保存
  - get_last_errorの動作
  - _要件: 8.3_

- [ ] 8.4 プロパティテストを実装
  - **プロパティ17: データ読み込みの一貫性**
  - **検証: 要件8.1**

- [ ] 8.5 プロパティテストを実装
  - **プロパティ18: データ結合の一貫性**
  - **検証: 要件8.2**

- [ ] 8.6 プロパティテストを実装
  - **プロパティ19: エラー処理の一貫性**
  - **検証: 要件8.3**

- [ ] 9. Data Pipelineのユニットテスト実装
- [ ] 9.1 パイプライン実行テストを実装
  - 全ステップの実行
  - データ変換の正確性
  - ソート処理
  - _要件: 7.1_

- [ ] 9.2 キャッシュ機能テストを実装
  - キャッシュの使用
  - キャッシュのクリア
  - _要件: 7.1, 7.2_

- [ ] 9.3 エラー処理テストを実装
  - データ読み込み失敗
  - データ変換エラー
  - 空のデータ処理
  - _要件: 7.3, 7.4_

- [ ] 9.4 プロパティテストを実装
  - **プロパティ16: エラー処理の一貫性**
  - **検証: 要件7.3**

- [ ] 10. Settingsのユニットテスト実装
- [ ] 10.1 環境変数読み込みテストを実装
  - 環境変数からの読み込み
  - デフォルト値の使用
  - 型変換
  - _要件: 9.1, 9.2_

- [ ] 10.2 バリデーションテストを実装
  - 無効な値の検証
  - エラーメッセージ
  - _要件: 9.3_

- [ ] 10.3 パス解決テストを実装
  - 相対パスから絶対パスへの変換
  - パスの正規化
  - _要件: 9.4_

- [ ] 10.4 プロパティテストを実装
  - **プロパティ21: 環境変数読み込みの一貫性**
  - **検証: 要件9.1**

- [ ] 10.5 プロパティテストを実装
  - **プロパティ22: 無効な値検証の一貫性**
  - **検証: 要件9.3**

- [ ] 10.6 プロパティテストを実装
  - **プロパティ23: パス解決の一貫性**
  - **検証: 要件9.4**

- [ ] 11. チェックポイント - フェーズ2のテスト実行
  - すべてのテストが成功することを確認
  - カバレッジが65%以上であることを確認
  - ユーザーに質問がある場合は確認

## フェーズ3: プロパティベーステストと追加テスト（カバレッジ目標: 70%+）

- [ ] 12. Logging Configのユニットテスト実装
- [ ] 12.1 ロガー設定テストを実装
  - ログレベルの設定
  - ハンドラーの設定
  - フォーマットの設定
  - _要件: 5.1, 5.4_

- [ ] 12.2 ファイルロギングテストを実装
  - ファイルハンドラーの作成
  - ログファイルへの出力
  - ディレクトリの自動作成
  - _要件: 5.2_

- [ ] 12.3 ログローテーションテストを実装
  - ローテーション設定
  - バックアップファイルの作成
  - _要件: 5.3_

- [ ] 12.4 複数ハンドラーテストを実装
  - コンソールとファイルの両方
  - ハンドラーの独立性
  - _要件: 5.5_

- [ ] 12.5 プロパティテストを実装
  - **プロパティ11: ログレベル設定の一貫性**
  - **検証: 要件5.1**

- [ ] 12.6 プロパティテストを実装
  - **プロパティ12: ログフォーマットの一貫性**
  - **検証: 要件5.4**

- [ ] 13. 残りのプロパティテストを実装
- [ ] 13.1 Data Serviceのプロパティテストを追加
  - **プロパティ20: 欠損値処理の一貫性**
  - **検証: 要件8.4**

- [ ] 13.2 Settingsのプロパティテストを追加
  - **プロパティ24: 設定更新の一貫性**
  - **検証: 要件9.5**

- [ ] 14. エッジケースとエラーケースの追加テスト
- [ ] 14.1 境界値テストを追加
  - 空文字列
  - None値
  - 最大値・最小値
  - _要件: 全般_

- [ ] 14.2 並行処理テストを追加（オプション）
  - 複数スレッドからのアクセス
  - キャッシュの競合
  - _要件: 全般_

- [ ] 15. テストドキュメントの更新
- [ ] 15.1 テストREADMEを更新
  - 新しいテストの説明
  - 実行方法
  - カバレッジ目標
  - _要件: 全般_

- [ ] 15.2 カバレッジレポートを生成
  - HTML形式のレポート
  - モジュール別のカバレッジ
  - _要件: 10.1, 10.2_

- [ ] 16. 最終チェックポイント - すべてのテスト実行
  - すべてのテストが成功することを確認
  - カバレッジが70%以上であることを確認
  - テスト実行時間が5秒以内であることを確認
  - ユーザーに質問がある場合は確認
