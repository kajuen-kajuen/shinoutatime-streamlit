# 実装タスクリスト

- [ ] 1. プロジェクト構造とデータモデルの実装
  - データモデルクラス（LiveInfo、TimestampInfo、SongInfo等）を定義
  - プロジェクトの基本的なディレクトリ構造を作成
  - 必要な依存ライブラリをrequirements.txtに追加
  - _要件: 1.1, 1.2, 2.1_

- [ ] 1.1 データモデルの実装
  - src/models/song_list_models.pyを作成
  - LiveInfo、TimestampInfo、SongInfo、SimilarityWarning、DiffResultのdataclassを実装
  - _要件: 1.1, 1.2, 2.1_

- [ ] 1.2 データモデルのプロパティテスト
  - **プロパティ1: TSVファイル読み込みの完全性**
  - **検証: 要件1.1, 1.2**

- [ ] 2. リポジトリ層の実装
  - TSVファイルの読み書き機能を実装
  - エラーハンドリングとエンコーディング検出を実装
  - _要件: 1.1, 1.2, 1.3, 1.4, 1.5, 5.1, 5.2, 5.5_

- [ ] 2.1 LiveRepositoryの実装
  - src/repositories/live_repository.pyを作成
  - M_YT_LIVE.TSVの読み込み機能を実装
  - 配信日のパース処理を実装
  - _要件: 1.1, 1.3, 1.4, 1.5_

- [ ] 2.2 TimestampRepositoryの実装
  - src/repositories/timestamp_repository.pyを作成
  - M_YT_LIVE_TIMESTAMP.TSVの読み込み機能を実装
  - _要件: 1.2, 1.3, 1.4, 1.5_

- [ ] 2.3 SongListRepositoryの実装
  - src/repositories/song_list_repository.pyを作成
  - V_SONG_LIST.TSVの読み込みと書き込み機能を実装
  - UTF-8エンコーディングでの保存を実装
  - _要件: 5.1, 5.2, 5.5, 8.1_

- [ ] 2.4 リポジトリ層のプロパティテスト
  - **プロパティ11: ファイルエンコーディングの一貫性**
  - **検証: 要件1.5, 5.5**

- [ ] 3. ユーティリティコンポーネントの実装
  - アーティスト名のソート用読み仮名生成
  - タイムスタンプ付きURL生成
  - 類似度計算
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5, 9.3_

- [ ] 3.1 ArtistSortGeneratorの実装
  - src/utils/artist_sort_generator.pyを作成
  - pykakasiを使用した読み仮名生成を実装
  - 英数字のみの場合の処理を実装
  - エラーハンドリングとフォールバック処理を実装
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 3.2 ArtistSortGeneratorのプロパティテスト
  - **プロパティ6: ソート用アーティスト名の生成**
  - **検証: 要件3.1**

- [ ] 3.3 URLGeneratorの実装
  - src/utils/url_generator.pyを作成
  - タイムスタンプのパース処理（HH:MM:SS、MM:SS形式）を実装
  - タイムスタンプ付きURL生成を実装
  - 既存クエリパラメータの保持処理を実装
  - _要件: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 3.4 URLGeneratorのプロパティテスト
  - **プロパティ7: タイムスタンプ変換のラウンドトリップ**
  - **検証: 要件4.1, 4.2, 4.3, 4.4**

- [ ] 3.5 URLGeneratorのプロパティテスト
  - **プロパティ8: URL生成の正確性**
  - **検証: 要件4.1, 4.5**

- [ ] 3.6 SimilarityCheckerの実装
  - src/utils/similarity_checker.pyを作成
  - python-Levenshteinを使用した類似度計算を実装
  - 類似ペア検出機能を実装
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 3.7 SimilarityCheckerのプロパティテスト
  - **プロパティ12: 類似性チェックの対称性**
  - **検証: 要件9.3**

- [ ] 3.8 SimilarityCheckerのプロパティテスト
  - **プロパティ13: 類似性検出の正確性**
  - **検証: 要件9.1, 9.2, 9.4**

- [ ] 4. サービス層の実装
  - データ結合と集計ロジックを実装
  - 曲名正規化処理を実装
  - 類似性チェック機能を実装
  - 差分検出機能を実装
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 8.1, 8.2, 8.3, 8.4, 9.1, 9.2_

- [ ] 4.1 SongListServiceの基本実装
  - src/services/song_list_service.pyを作成
  - データ結合処理を実装（配信情報とタイムスタンプ情報の結合）
  - 空データのフィルタリングを実装
  - _要件: 2.1, 2.4, 2.5_

- [ ] 4.2 データ結合のプロパティテスト
  - **プロパティ2: データ結合の完全性**
  - **検証: 要件2.1, 2.4**

- [ ] 4.3 空データ除外のプロパティテスト
  - **プロパティ10: 空データの除外**
  - **検証: 要件2.5**

- [ ] 4.4 最新歌唱選択ロジックの実装
  - 同じ曲の複数レコードから最新を選択する処理を実装
  - 配信日とIDによる優先順位付けを実装
  - _要件: 2.2, 2.3_

- [ ] 4.5 最新歌唱選択のプロパティテスト
  - **プロパティ3: 最新歌唱の正確性**
  - **検証: 要件2.2, 2.3**

- [ ] 4.6 曲名正規化処理の実装
  - バリエーション表記（(1chorus)、(short ver)等）の検出と除去を実装
  - 正規版とバリエーション版の優先順位付けを実装
  - _要件: 2.6, 2.7_

- [ ] 4.7 曲名正規化のプロパティテスト
  - **プロパティ4: バリエーション表記の優先順位**
  - **検証: 要件2.6, 2.7**

- [ ] 4.8 曲名正規化のプロパティテスト
  - **プロパティ5: 曲名正規化の冪等性**
  - **検証: 要件2.6, 2.7**

- [ ] 4.9 類似性チェック機能の実装
  - アーティスト名の類似性チェックを実装
  - 曲名の類似性チェックを実装
  - 警告メッセージの生成を実装
  - _要件: 9.1, 9.2, 9.4_

- [ ] 4.10 差分検出機能の実装
  - 既存ファイルとの比較処理を実装
  - 追加・削除・更新の検出を実装
  - 差分レポートの生成を実装
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ] 5. ソート処理の実装
  - ソート用アーティスト名と曲名による2段階ソートを実装
  - _要件: 5.3, 5.4_

- [ ] 5.1 ソート処理の実装
  - SongListServiceにソート処理を追加
  - ソート用アーティスト名の昇順、曲名の昇順でソート
  - _要件: 5.3, 5.4_

- [ ] 5.2 ソート処理のプロパティテスト
  - **プロパティ9: ソート順の正確性**
  - **検証: 要件5.3, 5.4**

- [ ] 6. CLIコンポーネントの実装
  - コマンドライン引数の解析を実装
  - ログ設定を実装
  - メイン処理フローを実装
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 6.1 CLIの基本実装
  - src/cli/song_list_generator.pyを作成
  - argparseを使用したコマンドライン引数解析を実装
  - ヘルプとバージョン表示を実装
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 6.2 ログ設定の実装
  - ログレベルの設定を実装
  - 詳細モード（--verbose）の実装
  - エラーと警告の適切な出力を実装
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 6.3 メイン処理フローの実装
  - リポジトリとサービスの初期化を実装
  - データ読み込み → 処理 → 出力の流れを実装
  - ドライランモードの実装
  - エラーハンドリングを実装
  - _要件: 6.1, 6.2, 6.3, 8.5_

- [ ] 6.4 処理サマリーの実装
  - 処理されたレコード数の表示を実装
  - 出力ファイルパスの表示を実装
  - 差分情報の表示を実装
  - 類似性警告の表示を実装
  - _要件: 7.3, 8.2, 8.3, 8.4, 9.1, 9.2_

- [ ] 7. 統合テストとドキュメント
  - エンドツーエンドの統合テストを作成
  - READMEとユーザーガイドを作成
  - _要件: すべて_

- [ ] 7.1 テストフィクスチャの作成
  - tests/fixtures/ディレクトリを作成
  - サンプルTSVファイルを作成（正常系・異常系）
  - _要件: すべて_

- [ ] 7.2 統合テストの実装
  - tests/integration/test_song_list_generator.pyを作成
  - 正常系のエンドツーエンドテストを実装
  - 異常系のエラーハンドリングテストを実装
  - _要件: すべて_

- [ ] 7.3 READMEの作成
  - インストール手順を記述
  - 使用方法とコマンドライン引数の説明を記述
  - 使用例を記述
  - _要件: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 8. チェックポイント - すべてのテストが通ることを確認
  - すべてのテストが通ることを確認し、問題があれば質問する
