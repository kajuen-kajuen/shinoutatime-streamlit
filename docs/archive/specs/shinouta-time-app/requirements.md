# 要件定義書

## はじめに

本ドキュメントは、VTuber「幽音しの」さんの配信で歌唱された楽曲を検索・閲覧できる非公式ファンサイト「しのうたタイム」の要件を定義します。本アプリケーションは、Streamlitフレームワークを使用したWebアプリケーションとして実装されています。

## 用語集

- **System**: しのうたタイムアプリケーション
- **User**: アプリケーションを利用するファン
- **TSVファイル**: タブ区切り形式のデータファイル
- **配信データ**: YouTubeライブ配信の情報（配信日、タイトル、URL等）
- **楽曲データ**: 配信内で歌唱された楽曲の情報（曲名、アーティスト、タイムスタンプ等）
- **タイムスタンプ**: 配信動画内の特定時刻を示す時間情報（HH:MM:SS形式）
- **検索クエリ**: Userが入力する検索キーワード

## 要件

### 要件1: データ読み込み機能

**ユーザーストーリー:** アプリケーション管理者として、配信情報と楽曲情報をTSVファイルから読み込めるようにしたい。これにより、データの更新と管理が容易になる。

#### 受入基準

1. WHEN Systemが起動する, THE System SHALL data/M_YT_LIVE.TSVファイルから配信データを読み込む
2. WHEN Systemが起動する, THE System SHALL data/M_YT_LIVE_TIMESTAMP.TSVファイルから楽曲データを読み込む
3. IF TSVファイルが存在しない, THEN THE System SHALL エラーメッセージを表示する
4. IF TSVファイルの読み込みに失敗する, THEN THE System SHALL 具体的なエラー内容をUserに通知する
5. WHEN データ読み込みが完了する, THE System SHALL 配信データと楽曲データをLIVE_IDをキーとして結合する

### 要件2: 楽曲検索機能

**ユーザーストーリー:** ファンとして、曲名やアーティスト名で楽曲を検索したい。これにより、聴きたい楽曲を素早く見つけられる。

#### 受入基準

1. THE System SHALL 検索キーワード入力欄を提供する
2. THE System SHALL 検索ボタンを提供する
3. WHEN Userが検索ボタンをクリックする, THE System SHALL 検索クエリに基づいて楽曲データをフィルタリングする
4. THE System SHALL 曲名フィールドに対して部分一致検索を実行する
5. THE System SHALL アーティストフィールドに対して部分一致検索を実行する
6. THE System SHALL 大文字小文字を区別せずに検索を実行する
7. WHEN 検索結果が存在する, THE System SHALL マッチした件数を表示する
8. WHEN 検索キーワードが空である, THE System SHALL 全件を表示する

### 要件3: ライブ配信タイトル検索機能

**ユーザーストーリー:** ファンとして、配信タイトルでも検索できるようにしたい。これにより、特定の配信回で歌われた楽曲を見つけやすくなる。

#### 受入基準

1. THE System SHALL ライブ配信タイトルを検索対象に含めるチェックボックスを提供する
2. WHEN チェックボックスがオンである, THE System SHALL ライブタイトルフィールドに対しても検索を実行する
3. WHEN チェックボックスがオフである, THE System SHALL ライブタイトルフィールドを検索対象から除外する

### 要件4: 検索結果表示機能

**ユーザーストーリー:** ファンとして、検索結果を見やすい形式で閲覧したい。これにより、必要な情報を素早く把握できる。

#### 受入基準

1. THE System SHALL 検索結果をテーブル形式で表示する
2. THE System SHALL 配信日、曲目番号、曲名、アーティスト、YouTubeリンクの列を表示する
3. THE System SHALL 配信日の降順で検索結果をソートする
4. WHEN 同一配信日に複数の配信が存在する, THE System SHALL LIVE_IDの昇順でソートする
5. WHEN 同一配信内に複数の楽曲が存在する, THE System SHALL タイムスタンプの昇順でソートする
6. THE System SHALL 初期表示件数を25件に制限する

### 要件5: 段階的表示機能

**ユーザーストーリー:** ファンとして、検索結果が多い場合に段階的に表示を増やしたい。これにより、ページの読み込み速度を維持しながら多くの結果を閲覧できる。

#### 受入基準

1. WHEN 検索結果が25件を超える, THE System SHALL 「さらに25件表示」ボタンを表示する
2. WHEN Userが「さらに25件表示」ボタンをクリックする, THE System SHALL 表示件数を25件追加する
3. THE System SHALL 現在の表示件数と総件数を表示する
4. WHEN 全ての検索結果が表示されている, THE System SHALL 全件表示完了メッセージを表示する

### 要件6: YouTubeリンク生成機能

**ユーザーストーリー:** ファンとして、楽曲が歌唱された配信の該当箇所に直接ジャンプしたい。これにより、すぐに目的の歌唱を視聴できる。

#### 受入基準

1. THE System SHALL タイムスタンプ文字列を秒数に変換する
2. THE System SHALL 配信URLとタイムスタンプ秒数を組み合わせてYouTubeタイムスタンプ付きURLを生成する
3. THE System SHALL 生成したURLをHTMLリンクとして表示する
4. WHEN UserがYouTubeリンクをクリックする, THE System SHALL 新しいタブでYouTube動画を開く
5. THE System SHALL 動画を指定されたタイムスタンプ位置から再生開始する

### 要件7: 曲目番号生成機能

**ユーザーストーリー:** ファンとして、配信内での歌唱順序を把握したい。これにより、配信の流れを理解しやすくなる。

#### 受入基準

1. THE System SHALL 各配信内で楽曲に連番を振る
2. WHEN 同一日に複数の配信が存在する, THE System SHALL 配信番号を付与する
3. WHEN 同一日に複数の配信が存在する, THE System SHALL 曲目を「配信番号-曲順」形式で表示する
4. WHEN 同一日に配信が1つのみ存在する, THE System SHALL 曲目を「曲順」形式で表示する

### 要件8: 楽曲リスト表示機能

**ユーザーストーリー:** ファンとして、歌唱された全楽曲の一覧をアーティスト順で閲覧したい。これにより、特定のアーティストの楽曲を探しやすくなる。

#### 受入基準

1. THE System SHALL data/V_SONG_LIST.TSVファイルから楽曲リストデータを読み込む
2. THE System SHALL アーティスト名のソート用フィールドを使用してデータをソートする
3. THE System SHALL アルファベットの大文字小文字を区別せずにソートする
4. THE System SHALL アーティスト名、曲名、最近の歌唱へのリンクを表示する
5. THE System SHALL 全件数を表示する

### 要件9: 情報ページ表示機能

**ユーザーストーリー:** ファンとして、配信スケジュールやお知らせ情報を確認したい。これにより、最新の活動情報を把握できる。

#### 受入基準

1. THE System SHALL YouTube動画埋め込み表示機能を提供する
2. THE System SHALL Twitter投稿埋め込み表示機能を提供する
3. THE System SHALL data/tweet_embed_code.htmlファイルからTwitter埋め込みコードを読み込む
4. THE System SHALL data/tweet_height.txtファイルから表示高さ設定を読み込む
5. WHEN 埋め込みコードファイルが存在しない, THE System SHALL 情報メッセージを表示する
6. THE System SHALL 過去のお知らせを展開可能なセクションで表示する

### 要件10: About Usページ表示機能

**ユーザーストーリー:** ファンとして、サイトの目的や制作者情報を知りたい。これにより、サイトの信頼性と背景を理解できる。

#### 受入基準

1. THE System SHALL サイトの目的説明を表示する
2. THE System SHALL 非公式サイトである旨の注意事項を表示する
3. THE System SHALL データの正確性に関する免責事項を表示する
4. THE System SHALL スペシャルサンクスセクションを表示する
5. THE System SHALL 参考にしたサイトへのリンクを提供する

### 要件11: UI/UXデザイン機能

**ユーザーストーリー:** ファンとして、見やすく使いやすいインターフェースで情報を閲覧したい。これにより、快適にサイトを利用できる。

#### 受入基準

1. THE System SHALL カスタムCSSスタイルを適用する
2. THE System SHALL ページタイトルに「しのうたタイム」を設定する
3. THE System SHALL ページアイコンに👻絵文字を設定する
4. THE System SHALL ワイドレイアウトを使用する
5. THE System SHALL テーブルのアーティスト列で改行を許可する
6. THE System SHALL その他の列では改行を防止する
7. THE System SHALL レスポンシブデザインを実装する

### 要件12: フッター表示機能

**ユーザーストーリー:** ファンとして、各ページで一貫したフッター情報を確認したい。これにより、サイト全体の統一感が保たれる。

#### 受入基準

1. THE System SHALL 全ページで共通のフッターを表示する
2. THE System SHALL フッター表示機能をfooter.pyモジュールとして提供する
3. THE System SHALL 各ページでdisplay_footer関数を呼び出してフッターを表示する

### 要件13: エラーハンドリング機能

**ユーザーストーリー:** ファンとして、エラーが発生した際に適切なメッセージを受け取りたい。これにより、問題の原因を理解し対処できる。

#### 受入基準

1. WHEN ファイル読み込みエラーが発生する, THE System SHALL エラーメッセージを表示する
2. WHEN CSSファイルが見つからない, THE System SHALL エラーメッセージと対処方法を表示する
3. WHEN データ変換エラーが発生する, THE System SHALL 警告メッセージを表示する
4. THE System SHALL エラー発生時もアプリケーションの動作を継続する
5. THE System SHALL エラーの種類に応じて適切なメッセージレベル（error/warning/info）を使用する
