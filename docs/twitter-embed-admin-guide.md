# Twitter埋め込みコード管理画面 使用ガイド

## 概要

Twitter埋め込みコード管理画面は、Streamlitアプリケーション内でTwitterのツイートURLから埋め込みコードを自動取得し、`data/tweet_embed_code.html`ファイルに保存するための管理画面です。

## アクセス方法

1. Streamlitアプリケーションを起動
2. サイドバーから「Twitter Embed Admin」ページを選択
3. 管理者パスワードを入力してログイン

## 認証

### パスワード設定

管理画面へのアクセスには管理者パスワードが必要です。パスワードは環境変数で設定します：

```bash
ADMIN_PASSWORD=your_secure_password
```

環境変数が設定されていない場合、デフォルトパスワード `admin` が使用されます。

**セキュリティ上の注意:**
- 本番環境では必ず強力なパスワードを設定してください
- `.env`ファイルに設定し、`.gitignore`に含めてください
- パスワードをコードにハードコーディングしないでください

## 使用方法

### 1. ログイン

1. 管理画面にアクセス
2. パスワードを入力
3. 「ログイン」ボタンをクリック

### 2. ツイートURL入力

1. テキストエリアにツイートURLを入力
   - 単一のツイート: 1つのURLを入力
   - 複数のツイート: 1行に1つずつURLを入力

**対応URL形式:**
- `https://twitter.com/username/status/1234567890`
- `https://x.com/username/status/1234567890`
- `https://mobile.twitter.com/username/status/1234567890`

### 3. オプション設定

- **バックアップを作成**: 既存のファイルをバックアップしてから保存（推奨）
- **取得後に自動保存**: 取得成功後、確認なしで自動的にファイルに保存

### 4. 取得実行

1. 「取得」ボタンをクリック
2. 処理の進行状況を確認
3. 取得結果のサマリーを確認
   - 総件数
   - 成功件数
   - 失敗件数
   - 失敗したURL（ある場合）

### 5. プレビュー確認

取得に成功すると、埋め込みコードのプレビューが表示されます。
実際にどのように表示されるか確認できます。

### 6. 保存

1. プレビューを確認
2. 「保存」ボタンをクリック
3. ファイルへの保存が完了

**保存されるファイル:**
- `data/tweet_embed_code.html`: 埋め込みHTMLコード
- `data/tweet_height.txt`: 表示高さ（ピクセル）
- `data/backups/tweet_embed_code_YYYYMMDD_HHMMSS.html`: バックアップ（オプション有効時）

## 機能詳細

### 認証機能

- セッションベースの認証
- パスワード入力による認証
- ログアウト機能
- 未認証時のアクセス制御

### URL検証

- ツイートURL形式の検証
- 無効なURLの検出とエラー表示
- 複数URL対応

### 埋め込みコード取得

- Twitter oEmbed APIを使用
- 自動リトライ機能
- エラーハンドリング
- 進行状況表示

### プレビュー機能

- 取得した埋め込みコードのリアルタイムプレビュー
- 実際の表示を確認
- 高さの自動調整

### ファイル保存

- 既存ファイルのバックアップ作成
- 埋め込みコードの保存
- 表示高さの保存
- エラーハンドリング

### ログ記録

全ての操作はログファイルに記録されます：
- 認証の成功/失敗
- 埋め込みコード取得の成功/失敗
- ファイル保存の成功/失敗
- エラー情報

ログファイル: `logs/twitter_embed.log`

## トラブルシューティング

### ログインできない

- パスワードが正しいか確認
- 環境変数`ADMIN_PASSWORD`が設定されているか確認
- ブラウザのキャッシュをクリア

### URLが無効と表示される

- URL形式が正しいか確認
- twitter.comまたはx.comのURLか確認
- ツイートIDが含まれているか確認

### 取得に失敗する

- インターネット接続を確認
- ツイートが存在するか確認（削除されていないか）
- ツイートが公開設定か確認
- ログファイルでエラー詳細を確認

### 保存に失敗する

- ファイルの書き込み権限を確認
- ディスク容量を確認
- `data`ディレクトリが存在するか確認
- ログファイルでエラー詳細を確認

## セキュリティ考慮事項

### アクセス制御

- 管理画面へのアクセスには認証が必要
- セッションベースの認証状態管理
- ログアウト機能の提供

### パスワード管理

- 環境変数による安全な管理
- ログへのパスワード非出力
- 強力なパスワードの推奨

### ファイル操作

- バックアップ機能による安全な上書き
- エラー時のロールバック
- ファイルパスの検証

## 関連ドキュメント

- [Twitter埋め込み機能 技術ドキュメント](twitter-embed-credentials.md)
- [設計書](.kiro/specs/twitter-embed-automation/design.md)
- [要件定義書](.kiro/specs/twitter-embed-automation/requirements.md)

## サポート

問題が発生した場合は、以下を確認してください：

1. ログファイル: `logs/twitter_embed.log`
2. エラーメッセージ
3. ブラウザのコンソール（開発者ツール）

それでも解決しない場合は、開発チームに連絡してください。
