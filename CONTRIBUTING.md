# コントリビューションガイド

「しのうたタイム」プロジェクトへの貢献に興味を持っていただき、ありがとうございます！

本ドキュメントでは、プロジェクトへの貢献方法について説明します。

> **注意**: 本ドキュメントは、将来的な実運用を想定して事前に作成されたものです。現時点ではまだ実運用は開始されておらず、実際の運用開始時には内容が変更される可能性があります。

## 目次

- [行動規範](#行動規範)
- [貢献の種類](#貢献の種類)
- [開発環境のセットアップ](#開発環境のセットアップ)
- [イシューの報告](#イシューの報告)
- [プルリクエストの作成](#プルリクエストの作成)
- [コードレビュープロセス](#コードレビュープロセス)
- [コーディング規約](#コーディング規約)
- [コミットメッセージ規約](#コミットメッセージ規約)
- [データ更新のガイドライン](#データ更新のガイドライン)

## 行動規範

本プロジェクトは、すべての貢献者に対して敬意を持って接することを期待しています。以下の行動規範を守ってください：

- 建設的で礼儀正しいコミュニケーションを心がける
- 他の貢献者の意見や視点を尊重する
- プロジェクトの目的（ファンサイトとしての健全な運営）を理解し、協力する
- 個人攻撃や不適切な言動を避ける

## 貢献の種類

以下のような貢献を歓迎します：

### 1. バグ報告
- アプリケーションの不具合を発見した場合
- データの誤りを発見した場合
- 表示の問題を発見した場合

### 2. 機能提案
- 新しい機能のアイデア
- 既存機能の改善提案
- UI/UXの改善提案

### 3. ドキュメント改善
- ドキュメントの誤字脱字の修正
- 説明の追加や改善
- 翻訳の追加

### 4. コード貢献
- バグ修正
- 新機能の実装
- パフォーマンス改善
- リファクタリング

### 5. データ貢献
- 楽曲データの追加
- 配信データの追加
- データの誤り修正

## 開発環境のセットアップ


### 1. リポジトリのフォーク

GitHubでプロジェクトのリポジトリをフォークします。

### 2. ローカルにクローン

```bash
git clone https://github.com/YOUR_USERNAME/shinouta-time.git
cd shinouta-time
```

### 3. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 4. 開発用ブランチの作成

```bash
git checkout -b feature/your-feature-name
```

ブランチ名の命名規則：
- 新機能: `feature/機能名`
- バグ修正: `fix/バグ内容`
- ドキュメント: `docs/内容`
- データ更新: `data/更新内容`

### 5. アプリケーションの起動

```bash
streamlit run Home.py
```

ブラウザで `http://localhost:8501` にアクセスして動作確認します。

## イシューの報告

バグや機能提案を報告する際は、以下の手順に従ってください。

### バグ報告

バグを発見した場合は、以下の情報を含めてイシューを作成してください：

**イシューテンプレート（バグ報告）**

```markdown
## バグの概要
[バグの簡潔な説明]

## 再現手順
1. [手順1]
2. [手順2]
3. [手順3]

## 期待される動作
[本来どのように動作すべきか]

## 実際の動作
[実際にどのように動作したか]

## スクリーンショット
[可能であればスクリーンショットを添付]

## 環境情報
- OS: [例: Windows 11, macOS 14.0, Ubuntu 22.04]
- ブラウザ: [例: Chrome 120, Firefox 121, Safari 17]
- Python バージョン: [例: Python 3.11.5]
- Streamlit バージョン: [例: 1.29.0]

## 追加情報
[その他の関連情報]
```

### 機能提案

新機能を提案する場合は、以下の情報を含めてください：

**イシューテンプレート（機能提案）**

```markdown
## 機能の概要
[提案する機能の簡潔な説明]

## 動機・背景
[なぜこの機能が必要か、どのような問題を解決するか]

## 提案する解決策
[具体的にどのように実装するか]

## 代替案
[他に考えられる実装方法]

## 追加情報
[その他の関連情報、参考資料など]
```

### データの誤り報告

データの誤りを発見した場合：

**イシューテンプレート（データ誤り）**

```markdown
## データの誤りの概要
[誤りの簡潔な説明]

## 該当データ
- 配信日: [例: 2024/01/15]
- 曲名: [例: 曲名]
- アーティスト: [例: アーティスト名]

## 現在のデータ
[現在登録されている誤ったデータ]

## 正しいデータ
[正しいデータ]

## 情報源
[正しいデータの根拠となる情報源（配信URL、タイムスタンプなど）]
```

## プルリクエストの作成


プルリクエスト（PR）を作成する際は、以下の手順に従ってください。

### 1. 変更の実装

開発用ブランチで変更を実装します。

```bash
# 変更を加える
# ファイルを編集...

# 変更を確認
git status
git diff
```

### 2. コードのテスト

変更を加えた後は、必ずローカルでテストしてください：

```bash
# アプリケーションを起動
streamlit run Home.py

# ブラウザで動作確認
# - 変更した機能が正しく動作するか
# - 既存の機能に影響がないか
# - エラーが発生しないか
```

### 3. コミット

変更をコミットします。コミットメッセージは[コミットメッセージ規約](#コミットメッセージ規約)に従ってください。

```bash
git add .
git commit -m "feat: 新機能の追加"
```

### 4. プッシュ

変更をフォークしたリポジトリにプッシュします。

```bash
git push origin feature/your-feature-name
```

### 5. プルリクエストの作成

GitHubでプルリクエストを作成します。以下の情報を含めてください：

**プルリクエストテンプレート**

```markdown
## 変更の概要
[変更内容の簡潔な説明]

## 変更の種類
- [ ] バグ修正
- [ ] 新機能
- [ ] ドキュメント更新
- [ ] データ更新
- [ ] リファクタリング
- [ ] その他: [説明]

## 関連イシュー
Closes #[イシュー番号]

## 変更内容の詳細
[変更内容の詳細な説明]

## テスト方法
[変更をテストする方法]

## スクリーンショット
[UI変更がある場合はスクリーンショットを添付]

## チェックリスト
- [ ] コードが正しく動作することを確認した
- [ ] 既存の機能に影響がないことを確認した
- [ ] コーディング規約に従っている
- [ ] 必要に応じてドキュメントを更新した
- [ ] コミットメッセージが規約に従っている
```

### 6. レビュー待ち

プルリクエストを作成したら、メンテナーによるレビューを待ちます。レビュー中に変更が必要な場合は、同じブランチに追加のコミットをプッシュしてください。

## コードレビュープロセス

プルリクエストは、以下のプロセスでレビューされます。

### レビューの流れ

1. **自動チェック**
   - コードの構文エラーがないか
   - 基本的なコーディング規約に従っているか

2. **メンテナーによるレビュー**
   - コードの品質
   - 機能の正確性
   - パフォーマンスへの影響
   - セキュリティ上の問題
   - ドキュメントの適切性

3. **フィードバック**
   - レビュアーがコメントや変更リクエストを行います
   - 必要に応じて修正を行ってください

4. **承認とマージ**
   - すべてのレビューコメントが解決されたら、PRが承認されます
   - メンテナーがmainブランチにマージします

### レビュー基準

以下の基準でレビューが行われます：

#### コード品質
- コードが読みやすく、理解しやすいか
- 適切なコメントが付けられているか
- 不要なコードが含まれていないか
- エラーハンドリングが適切か

#### 機能性
- 要件を満たしているか
- エッジケースが考慮されているか
- 既存の機能に悪影響がないか

#### パフォーマンス
- 不要な処理がないか
- データ処理が効率的か
- ページの読み込み速度に影響がないか

#### セキュリティ
- XSS（クロスサイトスクリプティング）の脆弱性がないか
- ユーザー入力の適切な処理がされているか

#### ドキュメント
- 変更に応じてドキュメントが更新されているか
- コメントが適切に記述されているか

### レビューへの対応

レビューコメントを受け取ったら：

1. **コメントを理解する**
   - 不明な点があれば質問する
   - 建設的な議論を心がける

2. **修正を行う**
   - 指摘された問題を修正する
   - 同じブランチに追加のコミットをプッシュする

3. **返信する**
   - 修正が完了したらコメントに返信する
   - 修正内容を簡潔に説明する

4. **再レビューを待つ**
   - メンテナーが再度レビューを行います

## コーディング規約


本プロジェクトでは、以下のコーディング規約に従ってください。

### Python コーディングスタイル

基本的に [PEP 8](https://peps.python.org/pep-0008/) に従います。

#### インデント
- スペース4つを使用
- タブは使用しない

```python
# 良い例
def example_function():
    if condition:
        do_something()
```

#### 命名規則

```python
# 変数名・関数名: スネークケース（小文字 + アンダースコア）
user_name = "example"
def calculate_total():
    pass

# クラス名: パスカルケース（各単語の先頭を大文字）
class DataProcessor:
    pass

# 定数: 大文字 + アンダースコア
MAX_DISPLAY_COUNT = 25
DEFAULT_HEIGHT = 850
```

#### インポート

```python
# 標準ライブラリ
import os
from pathlib import Path

# サードパーティライブラリ
import pandas as pd
import streamlit as st

# ローカルモジュール
from footer import display_footer
```

#### 行の長さ
- 1行は最大79文字を推奨
- 長い行は適切に改行する

```python
# 良い例
result = some_function(
    argument1,
    argument2,
    argument3
)
```

### コメントとdocstring

#### ファイル冒頭のdocstring

```python
"""
モジュールの説明

このモジュールは〇〇の機能を提供します。
"""
```

#### 関数のdocstring

```python
def convert_timestamp_to_seconds(timestamp_str):
    """
    タイムスタンプ文字列を秒数に変換する
    
    Args:
        timestamp_str (str): タイムスタンプ文字列（HH:MM:SS または MM:SS形式）
        
    Returns:
        int: 秒数。変換に失敗した場合はNone
        
    Examples:
        >>> convert_timestamp_to_seconds("01:23:45")
        5025
        >>> convert_timestamp_to_seconds("12:34")
        754
    """
```

#### インラインコメント

```python
# データを読み込む
df = pd.read_csv("data/file.tsv", delimiter="\t")

# LIVE_IDをキーとして結合
df_merged = pd.merge(df_songs, df_lives, left_on="LIVE_ID", right_on="ID", how="left")
```

### Streamlit 固有の規約

#### セッション状態の初期化

```python
# セッション状態の初期化は条件付きで行う
if "display_limit" not in st.session_state:
    st.session_state.display_limit = 25
```

#### キャッシュの使用

```python
# データ読み込みにはキャッシュを使用
@st.cache_data
def load_data(path):
    return pd.read_csv(path, delimiter="\t")
```

#### エラーメッセージ

```python
# エラーレベルに応じて適切なメッセージ関数を使用
st.error("エラー: ファイルが見つかりません。")
st.warning("警告: データの一部が欠損しています。")
st.info("情報: データの読み込みが完了しました。")
```

### CSS スタイル

#### ファイル構成
- 共通スタイルは `style.css` に記述
- ページ固有のスタイルはPythonファイル内に記述

#### コメント

```css
/* テーブルのスタイル設定 */
table.dataframe {
    width: 100%;
}

/* アーティスト列のみ改行を許可 */
.artist-cell {
    white-space: normal;
    word-break: break-word;
}
```

### データファイル（TSV）

#### フォーマット
- タブ区切り（TSV形式）
- UTF-8エンコーディング
- ヘッダー行を含む

#### カラム名
- 日本語を使用可能
- 意味が明確な名前を使用

## コミットメッセージ規約

コミットメッセージは以下の形式に従ってください：

### 基本形式

```
<type>: <subject>

<body>

<footer>
```

### Type（種類）

- `feat`: 新機能の追加
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更（空白、フォーマット、セミコロンなど）
- `refactor`: バグ修正や機能追加を伴わないコードの変更
- `perf`: パフォーマンス改善
- `test`: テストの追加や修正
- `chore`: ビルドプロセスやツールの変更
- `data`: データファイルの更新

### Subject（件名）

- 50文字以内
- 日本語で記述
- 命令形で記述（「〇〇を追加」「〇〇を修正」）
- 末尾にピリオドを付けない

### Body（本文）

- 変更の理由や詳細を記述
- 72文字で改行
- 省略可能

### Footer（フッター）

- 関連するイシュー番号を記述
- 省略可能

### 例

```
feat: 楽曲検索にアーティスト名フィルタを追加

アーティスト名で絞り込み検索ができるように、
ドロップダウンメニューを追加しました。

Closes #123
```

```
fix: タイムスタンプ変換時のエラーを修正

MM:SS形式のタイムスタンプが正しく変換されない
問題を修正しました。

Fixes #456
```

```
docs: READMEにセットアップ手順を追加
```

```
data: 2024年1月の配信データを追加
```

## データ更新のガイドライン


データファイルを更新する際は、以下のガイドラインに従ってください。

### データ追加の手順

#### 1. 配信データの追加（M_YT_LIVE.TSV）

新しい配信を追加する場合：

```tsv
ID	配信日	タイトル	URL
123	2024/01/15	【歌枠】〇〇	https://www.youtube.com/watch?v=xxxxx
```

- **ID**: 既存の最大ID + 1
- **配信日**: YYYY/MM/DD形式
- **タイトル**: 配信のタイトル
- **URL**: YouTube配信のURL

#### 2. 楽曲データの追加（M_YT_LIVE_TIMESTAMP.TSV）

配信内の楽曲を追加する場合：

```tsv
ID	LIVE_ID	曲名	アーティスト	タイムスタンプ
456	123	曲名	アーティスト名	01:23:45
```

- **ID**: 既存の最大ID + 1
- **LIVE_ID**: 対応する配信のID（M_YT_LIVE.TSVのID）
- **曲名**: 楽曲名
- **アーティスト**: アーティスト名
- **タイムスタンプ**: HH:MM:SS または MM:SS形式

#### 3. 楽曲リストの更新（V_SONG_LIST.TSV）

新しい楽曲をリストに追加する場合：

```tsv
アーティスト	アーティスト(ソート用)	曲名	最近の歌唱
アーティスト名	あーてぃすとめい	曲名	https://www.youtube.com/watch?v=xxxxx&t=5025s
```

- **アーティスト**: 表示用のアーティスト名
- **アーティスト(ソート用)**: ひらがなまたはアルファベット小文字
- **曲名**: 楽曲名
- **最近の歌唱**: タイムスタンプ付きYouTube URL

### データ更新時の注意事項

#### エンコーディング
- **必ずUTF-8エンコーディングで保存**
- BOM（Byte Order Mark）なし

#### 区切り文字
- タブ文字（`\t`）を使用
- カンマやスペースは使用しない

#### データの整合性
- LIVE_IDは必ずM_YT_LIVE.TSVに存在するIDを使用
- 同じ配信内の楽曲は、タイムスタンプの昇順で並べる
- IDは重複しないように注意

#### データの検証

データを追加・更新した後は、以下を確認してください：

1. **ファイルが正しく読み込めるか**
   ```bash
   streamlit run Home.py
   ```

2. **エラーが表示されないか**
   - ブラウザのコンソールを確認
   - Streamlitのターミナル出力を確認

3. **追加したデータが正しく表示されるか**
   - 検索機能で該当データを検索
   - 表示内容が正しいか確認

4. **既存データに影響がないか**
   - 既存の楽曲が正しく表示されるか
   - ソート順が正しいか

### データの情報源

データを追加する際は、以下の情報源を参考にしてください：

- **公式YouTubeチャンネル**: 配信のアーカイブ
- **配信のコメント欄**: 楽曲リストが記載されている場合がある
- **ファンコミュニティ**: 他のファンが作成した楽曲リスト

**重要**: データの正確性を保つため、必ず信頼できる情報源を使用してください。

## よくある質問（FAQ）

### Q: 初めての貢献で何から始めればいいですか？

A: まずは以下から始めることをお勧めします：
- ドキュメントの誤字脱字の修正
- データの誤り修正
- 小さなバグ修正

「good first issue」ラベルが付いたイシューを探すのも良いでしょう。

### Q: プルリクエストがマージされるまでどのくらいかかりますか？

A: 通常、数日から1週間程度です。ただし、メンテナーの状況により前後する場合があります。

### Q: レビューで変更を求められましたが、どうすればいいですか？

A: 同じブランチで修正を行い、追加のコミットをプッシュしてください。プルリクエストは自動的に更新されます。

### Q: データの追加方法がわかりません

A: [データ更新のガイドライン](#データ更新のガイドライン)を参照してください。不明な点があれば、イシューで質問してください。

### Q: 大きな機能を追加したいのですが

A: まずイシューで提案し、メンテナーと議論してから実装を始めることをお勧めします。

### Q: テストはどのように行えばいいですか？

A: 現在、自動テストは実装されていません。ローカルでアプリケーションを起動し、手動でテストしてください。

### Q: コードレビューで承認されましたが、マージされません

A: メンテナーがマージを行います。承認後、数日以内にマージされる予定です。

## 連絡先

質問や提案がある場合は、以下の方法でご連絡ください：

- **GitHub Issues**: バグ報告や機能提案
- **GitHub Discussions**: 一般的な質問や議論
- **Pull Requests**: コードの貢献

## 謝辞

本プロジェクトへの貢献に感謝します！あなたの貢献が、多くのファンの楽しみに繋がります。

---

**最終更新**: 2024年1月
**バージョン**: 1.0

